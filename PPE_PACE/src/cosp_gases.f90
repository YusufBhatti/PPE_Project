! $Revision: 88 $, $Date: 2013-11-13 15:08:38 +0100 (Mi, 13. Nov 2013) $
! $URL: http://cfmip-obs-sim.googlecode.com/svn/stable/v1.4.0/quickbeam/gases.f90 $
  function cosp_gases(PRES_mb,T,RH,f)

  USE mo_kind,		ONLY: wp

  implicit none
  
! Purpose:
!   Compute 2-way gaseous attenuation through a volume in microwave
!
! Inputs:
!   [PRES_mb]   pressure (mb) (hPa)
!   [T]         temperature (K)
!   [RH]        relative humidity (%)
!   [f]         frequency (GHz), < 300 GHz
!
! Returns:
!   2-way gaseous attenuation (dB/km)
!
! Reference:
!   Uses method of Liebe (1985)
!
! Created:
!   12/09/05  John Haynes (haynes@atmos.colostate.edu)
! Modified:
!   01/31/06  Port from IDL to Fortran 90

  integer, parameter :: &
  nbands_o2 = 48 ,&
  nbands_h2o = 30
  real(wp), intent(in) :: PRES_mb, T, RH, f
  real(wp) :: cosp_gases, th, e, p, sumo, gm0, a0, ap, term1, term2, term3, &
            bf, be, term4, npp
  real(wp), dimension(nbands_o2) :: v0, a1, a2, a3, a4, a5, a6
  real(wp), dimension(nbands_h2o) :: v1, b1, b2, b3
  real(wp) :: e_th,one_th,pth3,eth35,aux1,aux2,aux3,aux4
  real(wp) :: gm,delt,x,y,gm2
  real(wp) :: fpp_o2,fpp_h2o,s_o2,s_h2o

  integer :: i
  
! // table1 parameters  v0, a1, a2, a3, a4, a5, a6  
  data v0/49.4523790_wp,49.9622570_wp,50.4742380_wp,50.9877480_wp,51.5033500_wp, &
  52.0214090_wp,52.5423930_wp,53.0669060_wp,53.5957480_wp,54.1299999_wp,54.6711570_wp, &
  55.2213650_wp,55.7838000_wp,56.2647770_wp,56.3378700_wp,56.9681000_wp,57.6124810_wp, &
  58.3238740_wp,58.4465890_wp,59.1642040_wp,59.5909820_wp,60.3060570_wp,60.4347750_wp, &
  61.1505580_wp,61.8001520_wp,62.4112120_wp,62.4862530_wp,62.9979740_wp,63.5685150_wp, &
  64.1277640_wp,64.6789000_wp,65.2240670_wp,65.7647690_wp,66.3020880_wp,66.8368270_wp, &
  67.3695950_wp,67.9008620_wp,68.4310010_wp,68.9603060_wp,69.4890210_wp,70.0173420_wp, &
  118.7503410_wp,368.4983500_wp,424.7631200_wp,487.2493700,715.3931500_wp, &
  773.8387300_wp, 834.1453300_wp/
  data a1/0.0000001_wp,0.0000003_wp,0.0000009_wp,0.0000025_wp,0.0000061_wp,0.0000141_wp, &
  0.0000310_wp,0.0000641_wp,0.0001247_wp,0.0002280_wp,0.0003918_wp,0.0006316_wp,0.0009535_wp, &
  0.0005489_wp,0.0013440_wp,0.0017630_wp,0.0000213_wp,0.0000239_wp,0.0000146_wp,0.0000240_wp, &
  0.0000211_wp,0.0000212_wp,0.0000246_wp,0.0000250_wp,0.0000230_wp,0.0000193_wp,0.0000152_wp, &
  0.0000150_wp,0.0000109_wp,0.0007335_wp,0.0004635_wp,0.0002748_wp,0.0001530_wp,0.0000801_wp, &
  0.0000395_wp,0.0000183_wp,0.0000080_wp,0.0000033_wp,0.0000013_wp,0.0000005_wp,0.0000002_wp, &
  0.0000094_wp,0.0000679_wp,0.0006380_wp,0.0002350_wp,0.0000996_wp,0.0006710_wp,0.0001800_wp/
  data a2/11.8300000_wp,10.7200000_wp,9.6900000_wp,8.8900000_wp,7.7400000_wp,6.8400000_wp, &
  6.0000000_wp,5.2200000_wp,4.4800000_wp,3.8100000_wp,3.1900000_wp,2.6200000_wp,2.1150000_wp, &
  0.0100000_wp,1.6550000_wp,1.2550000_wp,0.9100000_wp,0.6210000_wp,0.0790000_wp,0.3860000_wp, &
  0.2070000_wp,0.2070000_wp,0.3860000_wp,0.6210000_wp,0.9100000_wp,1.2550000_wp,0.0780000_wp, &
  1.6600000_wp,2.1100000_wp,2.6200000_wp,3.1900000_wp,3.8100000_wp,4.4800000_wp,5.2200000_wp, &
  6.0000000_wp,6.8400000_wp,7.7400000_wp,8.6900000_wp,9.6900000_wp,10.7200000_wp,11.8300000_wp, &
  0.0000000_wp,0.0200000_wp,0.0110000_wp,0.0110000_wp,0.0890000_wp,0.0790000_wp,0.0790000_wp/
  data a3/0.0083000_wp,0.0085000_wp,0.0086000_wp,0.0087000_wp,0.0089000_wp,0.0092000_wp, &
  0.0094000_wp,0.0097000_wp,0.0100000_wp,0.0102000_wp,0.0105000_wp,0.0107900_wp,0.0111000_wp, &
  0.0164600_wp,0.0114400_wp,0.0118100_wp,0.0122100_wp,0.0126600_wp,0.0144900_wp,0.0131900_wp, &
  0.0136000_wp,0.0138200_wp,0.0129700_wp,0.0124800_wp,0.0120700_wp,0.0117100_wp,0.0146800_wp, &
  0.0113900_wp,0.0110800_wp,0.0107800_wp,0.0105000_wp,0.0102000_wp,0.0100000_wp,0.0097000_wp, &
  0.0094000_wp,0.0092000_wp,0.0089000_wp,0.0087000_wp,0.0086000_wp,0.0085000_wp,0.0084000_wp, &
  0.0159200_wp,0.0192000_wp,0.0191600_wp,0.0192000_wp,0.0181000_wp,0.0181000_wp,0.0181000_wp/
  data a4/0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp, &
  0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp, &
  0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp, &
  0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp, &
  0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp, &
  0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp, &
  0.0000000_wp,0.6000000_wp,0.6000000_wp,0.6000000_wp,0.6000000_wp,0.6000000_wp,0.6000000_wp/
  data a5/0.0056000_wp,0.0056000_wp,0.0056000_wp,0.0055000_wp,0.0056000_wp,0.0055000_wp, &
  0.0057000_wp,0.0053000_wp,0.0054000_wp,0.0048000_wp,0.0048000_wp,0.0041700_wp,0.0037500_wp, &
  0.0077400_wp,0.0029700_wp,0.0021200_wp,0.0009400_wp,-0.0005500_wp,0.0059700_wp,-0.0024400_wp, &
  0.0034400_wp,-0.0041300_wp,0.0013200_wp,-0.0003600_wp,-0.0015900_wp,-0.0026600_wp, &
  -0.0047700_wp,-0.0033400_wp,-0.0041700_wp,-0.0044800_wp,-0.0051000_wp,-0.0051000_wp, &
  -0.0057000_wp,-0.0055000_wp,-0.005900_wp,-0.0056000_wp,-0.0058000_wp,-0.0057000_wp, &
  -0.0056000_wp,-0.0056000_wp,-0.0056000_wp,-0.0004400_wp,0.0000000_wp,0.0000000_wp, &
  0.0000000_wp,0.0000000_wp,0.0000000_wp,0.0000000_wp/
  data a6/1.7000000_wp,1.7000000_wp,1.7000000_wp,1.7000000_wp,1.8000000_wp,1.8000000_wp,&
  1.8000000_wp,1.9000000_wp,1.8000000_wp,2.0000000_wp,1.9000000_wp,2.1000000_wp,2.1000000_wp, &
  0.9000000_wp,2.3000000_wp,2.5000000_wp,3.7000000_wp,-3.1000000_wp,0.8000000_wp,0.1000000_wp, &
  0.5000000_wp,0.7000000_wp,-1.0000000_wp,5.8000000_wp,2.9000000_wp,2.3000000_wp,0.9000000_wp, &
  2.2000000_wp,2.0000000_wp,2.0000000_wp,1.8000000_wp,1.9000000_wp,1.8000000_wp,1.8000000_wp, &
  1.7000000_wp,1.8000000_wp,1.7000000_wp,1.7000000_wp,1.7000000_wp,1.7000000_wp,1.7000000_wp, &
  0.9000000_wp,1.0000000_wp,1.0000000_wp,1.0000000_wp,1.0000000_wp,1.0000000_wp,1.0000000_wp/

! // table2 parameters  v1, b1, b2, b3
  data v1/22.2350800_wp,67.8139600_wp,119.9959400_wp,183.3101170_wp,321.2256440_wp, &
  325.1529190_wp,336.1870000_wp,380.1973720_wp,390.1345080_wp,437.3466670_wp,439.1508120_wp, &
  443.0182950_wp,448.0010750_wp,470.8889740_wp,474.6891270_wp,488.4911330_wp,503.5685320_wp, &
  504.4826920_wp,556.9360020_wp,620.7008070_wp,658.0065000_wp,752.0332270_wp,841.0735950_wp, &
  859.8650000_wp,899.4070000_wp,902.5550000_wp,906.2055240_wp,916.1715820_wp,970.3150220_wp, &
  987.9267640_wp/
  data b1/0.1090000_wp,0.0011000_wp,0.0007000_wp,2.3000000_wp,0.0464000_wp,1.5400000_wp, &
  0.0010000_wp,11.9000000_wp,0.0044000_wp,0.0637000_wp,0.9210000_wp,0.1940000_wp,10.6000000_wp, &
  0.3300000_wp,1.2800000_wp,0.2530000_wp,0.0374000_wp,0.0125000_wp,510.0000000_wp,5.0900000_wp, &
  0.2740000_wp,250.0000000_wp,0.0130000_wp,0.1330000_wp,0.0550000_wp,0.0380000_wp,0.1830000_wp, &
  8.5600000_wp,9.1600000_wp,138.0000000_wp/
  data b2/2.1430000_wp,8.7300000_wp,8.3470000_wp,0.6530000_wp,6.1560000_wp,1.5150000_wp, &
  9.8020000_wp,1.0180000_wp,7.3180000_wp,5.0150000_wp,3.5610000_wp,5.0150000_wp,1.3700000_wp, &
  3.5610000_wp,2.3420000_wp,2.8140000_wp,6.6930000_wp,6.6930000_wp,0.1140000_wp,2.1500000_wp, &
  7.7670000_wp,0.3360000_wp,8.1130000_wp,7.9890000_wp,7.8450000_wp,8.3600000_wp,5.0390000_wp, &
  1.3690000_wp,1.8420000_wp,0.1780000_wp/
  data b3/0.0278400_wp,0.0276000_wp,0.0270000_wp,0.0283500_wp,0.0214000_wp,0.0270000_wp, &
  0.0265000_wp,0.0276000_wp,0.0190000_wp,0.0137000_wp,0.0164000_wp,0.0144000_wp,0.0238000_wp, &
  0.0182000_wp,0.0198000_wp,0.0249000_wp,0.0115000_wp,0.0119000_wp,0.0300000_wp,0.0223000_wp, &
  0.0300000_wp,0.0286000_wp,0.0141000_wp,0.0286000_wp,0.0286000_wp,0.0264000_wp,0.0234000_wp, &
  0.0253000_wp,0.0240000_wp,0.0286000_wp/
  
! // conversions
  th = 300._wp/T		! unitless
  e = (RH*th**5)/(41.45_wp*10**(9.834_wp*th-10))	! kPa
  p = PRES_mb/10.-e	! kPa
  e_th = e*th
  one_th = 1 - th
  pth3 = p*th**(3)
  eth35 = e*th**(3.5_wp)

! // term1
  sumo = 0.
  aux1 = 1.1_wp*e_th
  do i=1,nbands_o2
    aux2 = f/v0(i)
    aux3 = v0(i)-f
    aux4 = v0(i)+f
    gm = a3(i)*(p*th**(0.8_wp-a4(i))+aux1)
    gm2 = gm**2
    delt = a5(i)*p*th**a6(i)
    x = aux3**2+gm2
    y = aux4**2+gm2
    fpp_o2 = (((1._wp/x)+(1._wp/y))*(gm*aux2) - (delt*aux2)*((aux3/(x))-(aux4/(x))))
    s_o2 = a1(i)*pth3*exp(a2(i)*one_th)
    sumo = sumo + fpp_o2 * s_o2
  enddo
  term1 = sumo

! // term2
  gm0 = 5.6E-3_wp*(p+1.1_wp*e)*th**(0.8_wp)
  a0 = 3.07E-4_wp
  ap = 1.4_wp*(1-1.2*f**(1.5_wp)*1E-5)*1E-10
  term2 = (2*a0*(gm0*(1+(f/gm0)**2)*(1+(f/60._wp)**2))**(-1) + ap*p*th**(2.5_wp)) &
          * f*p*th**2

! // term3
  sumo = 0._wp
  aux1 = 4.8_wp*e_th
  do i=1,nbands_h2o
    aux2 = f/v1(i)
    aux3 = v1(i)-f
    aux4 = v1(i)+f
    gm = b3(i)*(p*th**(0.8_wp)+aux1)
    gm2 = gm**2
    x = aux3**2+gm2
    y = aux4**2+gm2
    !delt = 0.
    fpp_h2o = ((1._wp/x)+(1._wp/y))*(gm*aux2) ! - (delt*aux2)*((aux3/(x))-(aux4/(x)))
    s_h2o = b1(i)*eth35*exp(b2(i)*one_th)
    sumo = sumo + fpp_h2o * s_h2o
  enddo
  term3 = sumo

! // term4
  bf = 1.4E-6_wp
  be = 5.41E-5_wp
  term4 = (bf*p+be*e*th**3)*f*e*th**(2.5_wp)

! // summation and result
  npp = term1 + term2 + term3 + term4
  cosp_gases = 0.182_wp*f*npp
  
  end function cosp_gases
